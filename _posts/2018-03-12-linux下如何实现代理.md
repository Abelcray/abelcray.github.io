# linux系统配置http全局代理

<!--markdown-->有时候在linux系统上操作时一些国外的源或者网站的软件需要下载安装，离线安装的方式又太过繁琐，配置http代理会方便一点。

准备工作
需要一个ss服务账号或者机器，服务端的部署不在此赘述。

------

CentOS系统（client端）
需要安装、配置ss客户端以及polipo
1、安装、配置shadowsocks

```
yum install python-pip -y  #安装pip
python -m pip install --upgrade pip 
#在此Linux默认安装python2.7,随机自带的pip版本过低可能在安装shadowsocks的过程中会报错（建议升级pip）
pip install shadowsocks    #安装shadowsocks
```

2、配置shadowsocks
创建shadowsocks配置文件

```
vim shadowsocks.json

{
"server":"x.x.x.x",         #ss服务端IP
"server_port":xxxx,         #ss服务端口
"local_port":1080,          #本地socks代理端口
"password":"Your password", #ss密码
"timeout":600,
"method":"aes-256-cfb"
}
```

3、启动ss客户端

```
sslocal -c shadowsocks.json -d start
```

4、验证sslocal是否正常启动

```
ss -linpo| grep 1080
udp    UNCONN     0      0      127.0.0.1:1080                  *:*                   users:(("sslocal",pid=8487,fd=5))
tcp    LISTEN     0      128    127.0.0.1:1080                  *:*                   users:(("sslocal",pid=8487,fd=4))
```

5、安装polipo(将socks5协议转换为http协议)(这里可能要安装依赖包make、texinfo)

```
git clone https://github.com/jech/polipo.git
cd polipo
make all
make install
```

6、配置polipo

```
vim polipo.config
socksParentProxy = "127.0.0.1:1080" #sslocal监听的本地端口
socksProxyType = socks5             #ss协议
proxyAddress = 0.0.0.0              #绑定地址，默认为127.0.0.1
proxyPort = 8123                    #http代理端口，默认为8123
logFile = /var/log/polipo
logLevel = 4
logSyslog = true
```

7、启动polipo（当前用户前台启动，后台启动可用nohuo）

```
polipo -c polipo.config
```

8、验证polipo正常启动

```
ss -linpo| grep 8123
tcp    LISTEN     0      128    127.0.0.1:8123                  *:*                   users:(("polipo",pid=13281,fd=5))
```

9、配置系统全局代理

```
echo "export http_proxy=http://localhost:8123" >>/etc/profile
echo "export https_proxy=http://localhost:8123" >>/etc/profile
source /etc/profile

```

10、验证代理是否成功

```
curl ip.gs
Current IP / 当前 IP: x.x.x.x
ISP / 运营商:  it7.net
City / 城市: Los Angeles California
Country / 国家: United States

```

配置成功！

参考链接：[https://www.cnblogs.com/thatsit/p/6481820.html?utm_source=itdadao&utm_medium=referral][1]

[1]: https://www.cnblogs.com/thatsit/p/6481820.html?utm_source=itdadao&utm_medium=referral

PS：目前使用trojan-gfw+kcptun+privoxy，以后有机会再介绍实际部署吧。。